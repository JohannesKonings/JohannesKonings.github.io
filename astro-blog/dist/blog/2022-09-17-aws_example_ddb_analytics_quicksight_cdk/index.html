<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v4.10.2"><!-- <link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin> --><link rel="preload" href="/fonts/CascadiaMonoNF.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/fonts/CascadiaMonoNF-SemiBold.woff2" as="font" type="font/woff2" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://johanneskonings.dev/blog/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/"><!-- Primary Meta Tags --><title>Example how to visualize DynamoDB item changes with Quicksight (S3 source) created with CDK | Johannes Konings</title><meta name="title" content="Example how to visualize DynamoDB item changes with Quicksight (S3 source) created with CDK | Johannes Konings"><meta name="description" content="This post is how to visualize the streamed data changes of a DynamoDb table via Kinesis Data Stream and Kinesis Firehose to S3. Build with CDK."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://johanneskonings.dev/blog/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/"><meta property="og:title" content="Example how to visualize DynamoDB item changes with Quicksight (S3 source) created with CDK | Johannes Konings"><meta property="og:description" content="This post is how to visualize the streamed data changes of a DynamoDb table via Kinesis Data Stream and Kinesis Firehose to S3. Build with CDK."><meta property="og:image" content="https://johanneskonings.dev/open-graph.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://johanneskonings.dev/blog/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/"><meta property="twitter:title" content="Example how to visualize DynamoDB item changes with Quicksight (S3 source) created with CDK | Johannes Konings"><meta property="twitter:description" content="This post is how to visualize the streamed data changes of a DynamoDb table via Kinesis Data Stream and Kinesis Firehose to S3. Build with CDK."><meta property="twitter:image" content="https://johanneskonings.dev/open-graph.jpg"><!-- Sitemap --><link rel="sitemap" href="/sitemap-index.xml"><!-- RSS Feed --><link rel="alternate" type="application/rss+xml" title="Example how to visualize DynamoDB item changes with Quicksight (S3 source) created with CDK | Johannes Konings" href="https://johanneskonings.dev/rss.xml"><!-- Global Scripts --><script src="/js/theme.js"></script><script src="/js/scroll.js"></script><script src="/js/animate.js"></script><!-- <ViewTransitions  /> --><link rel="stylesheet" href="/_astro/_slug_.COeGf7i0.css"><script type="module" src="/_astro/hoisted.BGfjo5mV.js"></script></head> <body> <header id="header" class="fixed top-0 w-full h-16 z-50" data-astro-cid-3ef6ksr2> <div class="w-full h-full mx-auto px-5 max-w-screen-md">  <div class="relative h-full w-full" data-astro-cid-3ef6ksr2> <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2" data-astro-cid-3ef6ksr2> <nav class="hidden md:flex items-center justify-center text-sm gap-1" data-astro-cid-3ef6ksr2> <a href="/" class="h-8 rounded-full px-3 text-current flex items-center justify-center transition-colors duration-300 ease-in-out hover:bg-black/5 dark:hover:bg-white/20 hover:text-black dark:hover:text-white" data-astro-cid-3ef6ksr2> Home </a><a href="/blog" class="h-8 rounded-full px-3 flex items-center justify-center transition-colors duration-300 ease-in-out bg-black dark:bg-white text-white dark:text-black" data-astro-cid-3ef6ksr2> Blog </a> </nav> </div> <div class="buttons absolute right-0 top-1/2 -translate-y-1/2 flex gap-1" data-astro-cid-3ef6ksr2> <a href="/search" aria-label="Search blog posts and projects on Johannes Konings" class="hidden md:flex size-9 rounded-full p-2 items-center justify-center bg-transparent hover:bg-black/5 dark:hover:bg-white/20 stroke-current hover:stroke-black hover:dark:stroke-white border border-black/10 dark:border-white/25 transition-colors duration-300 ease-in-out" data-astro-cid-3ef6ksr2> <svg class="size-full" data-astro-cid-3ef6ksr2> <use href="/ui.svg#search" data-astro-cid-3ef6ksr2></use> </svg> </a> <a href="/rss.xml" target="_blank" aria-label="Rss feed for Johannes Konings" class="hidden md:flex size-9 rounded-full p-2 items-center justify-center bg-transparent hover:bg-black/5 dark:hover:bg-white/20 stroke-current hover:stroke-black hover:dark:stroke-white border border-black/10 dark:border-white/25 transition-colors duration-300 ease-in-out" data-astro-cid-3ef6ksr2> <svg class="size-full" data-astro-cid-3ef6ksr2> <use href="/ui.svg#rss" data-astro-cid-3ef6ksr2></use> </svg> </a> <button id="header-theme-button" aria-label="Toggle light and dark theme" class="hidden md:flex size-9 rounded-full p-2 items-center justify-center bg-transparent hover:bg-black/5 dark:hover:bg-white/20 stroke-current hover:stroke-black hover:dark:stroke-white border border-black/10 dark:border-white/25 transition-colors duration-300 ease-in-out" data-astro-cid-3ef6ksr2> <svg class="size-full block dark:hidden" data-astro-cid-3ef6ksr2> <use href="/ui.svg#sun" data-astro-cid-3ef6ksr2></use> </svg> <svg class="size-full hidden dark:block" data-astro-cid-3ef6ksr2> <use href="/ui.svg#moon" data-astro-cid-3ef6ksr2></use> </svg> </button> <button id="header-drawer-button" aria-label="Toggle drawer open and closed" class="flex md:hidden size-9 rounded-full p-2 items-center justify-center bg-transparent hover:bg-black/5 dark:hover:bg-white/20 stroke-current hover:stroke-black hover:dark:stroke-white border border-black/10 dark:border-white/25 transition-colors duration-300 ease-in-out" data-astro-cid-3ef6ksr2> <svg id="drawer-open" class="size-full" data-astro-cid-3ef6ksr2> <use href="/ui.svg#menu" data-astro-cid-3ef6ksr2></use> </svg> <svg id="drawer-close" class="size-full" data-astro-cid-3ef6ksr2> <use href="/ui.svg#x" data-astro-cid-3ef6ksr2></use> </svg> </button> </div> </div>  </div> </header>  <script>
  function toggleDrawer() {
    const drawer = document.getElementById("drawer");
    const drawerButton = document.getElementById("header-drawer-button");
    drawer?.classList.toggle("open");
    drawerButton?.classList.toggle("open");
  }

  function initializeDrawerButton() {
    const drawerButton = document.getElementById("header-drawer-button");
    drawerButton?.addEventListener("click", toggleDrawer);
  }

  document.addEventListener("astro:after-swap", initializeDrawerButton);
  initializeDrawerButton();
</script> <div id="drawer" class="fixed inset-0 h-0 z-40 overflow-hidden flex flex-col items-center justify-center md:hidden bg-neutral-100 dark:bg-neutral-900 transition-[height] duration-300 ease-in-out" data-astro-cid-hxtyo74s> <nav class="flex flex-col items-center space-y-2" data-astro-cid-hxtyo74s> <a href="/" class="flex items-center justify-center px-3 py-1 rounded-full text-current hover:text-black dark:hover:text-white hover:bg-black/5 dark:hover:bg-white/20 transition-colors duration-300 ease-in-out" data-astro-cid-hxtyo74s> Home </a><a href="/blog" class="flex items-center justify-center px-3 py-1 rounded-full hover:text-black dark:hover:text-white hover:bg-black/5 dark:hover:bg-white/20 transition-colors duration-300 ease-in-out pointer-events-none bg-black dark:bg-white text-white dark:text-black" data-astro-cid-hxtyo74s> Blog </a> </nav> <div class="flex gap-1 mt-5" data-astro-cid-hxtyo74s> <a href="/search" aria-label="Search blog posts and projects on Johannes Konings" class="size-9 rounded-full p-2 items-center justify-center bg-transparent hover:bg-black/5 dark:hover:bg-white/20 stroke-current hover:stroke-black hover:dark:stroke-white border border-black/10 dark:border-white/25 transition-colors duration-300 ease-in-out" data-astro-cid-hxtyo74s> <svg class="size-full" data-astro-cid-hxtyo74s> <use href="/ui.svg#search" data-astro-cid-hxtyo74s></use> </svg> </a> <a href="/rss.xml" target="_blank" aria-label="Rss feed for Johannes Konings" class="size-9 rounded-full p-2 items-center justify-center bg-transparent hover:bg-black/5 dark:hover:bg-white/20 stroke-current hover:stroke-black hover:dark:stroke-white border border-black/10 dark:border-white/25 transition-colors duration-300 ease-in-out" data-astro-cid-hxtyo74s> <svg class="size-full" data-astro-cid-hxtyo74s> <use href="/ui.svg#rss" data-astro-cid-hxtyo74s></use> </svg> </a> <button id="drawer-theme-button" aria-label="Toggle light and dark theme" class="size-9 rounded-full p-2 items-center justify-center bg-transparent hover:bg-black/5 dark:hover:bg-white/20 stroke-current hover:stroke-black hover:dark:stroke-white border border-black/10 dark:border-white/25 transition-colors duration-300 ease-in-out" data-astro-cid-hxtyo74s> <svg class="block dark:hidden size-full" data-astro-cid-hxtyo74s> <use href="/ui.svg#sun" data-astro-cid-hxtyo74s></use> </svg> <svg class="hidden dark:block size-full" data-astro-cid-hxtyo74s> <use href="/ui.svg#moon" data-astro-cid-hxtyo74s></use> </svg> </button> </div> </div>  <main>  <div class="pt-36 pb-5"> <div class="w-full h-full mx-auto px-5 max-w-screen-md">   <div class="animate"> <div> <a href="/blog" class="group w-fit p-1.5 gap-1.5 text-sm flex items-center border rounded hover:bg-black/5 hover:dark:bg-white/10 border-black/15 dark:border-white/20 transition-colors duration-300 ease-in-out"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="stroke-current group-hover:stroke-black group-hover:dark:stroke-white"> <line x1="19" y1="12" x2="5" y2="12" class="scale-x-0 group-hover:scale-x-100 translate-x-3 group-hover:translate-x-0 transition-all duration-300 ease-in-out"></line> <polyline points="12 19 5 12 12 5" class="translate-x-1 group-hover:translate-x-0 transition-all duration-300 ease-in-out"></polyline> </svg> <div class="w-full group-hover:text-black group-hover:dark:text-white transition-colors duration-300 ease-in-out">
Back to blog </div> </a> <div class="flex flex-wrap text-sm uppercase mt-12 gap-3 opacity-75"> <div class="flex items-center gap-2"> <svg class="size-5 stroke-current"> <use href="/ui.svg#calendar"></use> </svg> Sep 17, 2022 </div> <div class="flex items-center gap-2"> <svg class="size-5 stroke-current"> <use href="/ui.svg#book-open"></use> </svg> 6 min read </div> </div> <h1 class="text-3xl font-semibold text-black dark:text-white mt-2"> Example how to visualize DynamoDB item changes with Quicksight (S3 source) created with CDK </h1> <div class="mt-1"> This post is how to visualize the streamed data changes of a DynamoDb table via Kinesis Data Stream and Kinesis Firehose to S3. Build with CDK. </div> <!-- {(demoUrl || repoUrl) && 
  <div class="mt-4 flex flex-wrap gap-2">
    {demoUrl && 
      <a href={demoUrl} target="_blank" class="group flex gap-2 items-center px-3 py-1.5 truncate rounded text-xs md:text-sm lg:text-base border border-black/25 dark:border-white/25 hover:bg-black/5 hover:dark:bg-white/15 blend">
        <svg class="size-4">
          <use href="/ui.svg#globe" class="fill-current group-hover:fill-black group-hover:dark:fill-white blend"/>
        </svg>
        <span class="text-current group-hover:text-black group-hover:dark:text-white blend">
          See Demo
        </span>
      </a>
    }
    {repoUrl && 
      <a href={repoUrl} target="_blank" class="group flex gap-2 items-center px-3 py-1.5 truncate rounded text-xs md:text-sm lg:text-base border border-black/25 dark:border-white/25 hover:bg-black/5 hover:dark:bg-white/15 blend">
        <svg class="size-4">
          <use href="/ui.svg#link" class="fill-current group-hover:fill-black group-hover:dark:fill-white blend"/>
        </svg>
        <span class="text-current group-hover:text-black group-hover:dark:text-white blend">
          See Repository
        </span>
      </a>
    }
  </div> 
  } --> </div> </div>   </div> </div> <div class="flex-1 py-5"> <div class="w-full h-full mx-auto px-5 max-w-screen-md">   <div class="animate"> <div> <article> <p>This post is about how to visualize the DynamoDb data changes with Quicksight. It’s an extension of [this]({{ site.baseurl }}/aws/2021/08/27/aws_example_ddb_analytics_cdk/) post, which describes how to analyze the data with Athena.
The setting for creating the DynamoDb table and putting the data changes to a S3 bucket is the same. Instead of creating an Athena table of the data in the S3 bucket, this data is linked to a data source in Quicksight.</p>
<h2 id="quicksight-activation-and-costs">Quicksight activation and costs</h2>
<p>Quicksight needs to be activated before using. It’s enough to use the standard edition for this scenario. The first 30 days are <a href="https://docs.aws.amazon.com/quicksight/latest/user/signing-up.html">free</a>. Costs are listed <a href="https://aws.amazon.com/quicksight/pricing/">here</a>.</p>
<p>![quicksight open service]({{ site.baseurl }}/img/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/quicksight-open-service.png)</p>
<p>![quicksight sign up]({{ site.baseurl }}/img/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/quicksight-sign-up.png)</p>
<p>![quicksight choose standard]({{ site.baseurl }}/img/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/quicksight-choose-standard.png)</p>
<p>Enter a name and an email address</p>
<p>![quicksight create standard]({{ site.baseurl }}/img/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/quicksight-create-standard.png)</p>
<h2 id="quicksight-role">Quicksight role</h2>
<p>In the <a href="https://docs.aws.amazon.com/quicksight/latest/user/security_iam_service-with-iam.html#security-create-iam-role">standard edition</a>, Quicksight uses a standard role that could be configured via the Quicksight console.</p>
<p>![quicksight permission access to aws services]({{ site.baseurl }}/img/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/quicksight-permission-access-to-aws-services.png)</p>
<p>Unfortunately, it is not possible to allow for specific KMS keys. For that, we need to add a policy to the role aws-quicksight-service-role-v0.</p>
<p><a href="https://github.com/JohannesKonings/test-aws-dynamodb-athena-cdk/blob/main/cdk/lib/quicksight/quicksight-role.ts">This</a> ads the needed permissions to that role.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { Construct } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'constructs'</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { aws_iam </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> iam, aws_s3 </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> s3 } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'aws-cdk-lib'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> interface</span><span style="color:#B392F0"> QuicksightRoleProps</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#FFAB70">  name</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> string</span></span>
<span class="line"><span style="color:#FFAB70">  bucket</span><span style="color:#F97583">:</span><span style="color:#B392F0"> s3</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">IBucket</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> QuicksightRole</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> Construct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">scope</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Construct</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">id</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> string</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">props</span><span style="color:#F97583">:</span><span style="color:#B392F0"> QuicksightRoleProps</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">    super</span><span style="color:#E1E4E8">(scope, id)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> quicksightRoleName</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> 'aws-quicksight-service-role-v0'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> quicksightRole</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> iam.Role.</span><span style="color:#B392F0">fromRoleName</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'quicksight-role'</span><span style="color:#E1E4E8">, quicksightRoleName)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    quicksightRole.</span><span style="color:#B392F0">attachInlinePolicy</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#F97583">      new</span><span style="color:#E1E4E8"> iam.</span><span style="color:#B392F0">Policy</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">`${</span><span style="color:#E1E4E8">props</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">name</span><span style="color:#9ECBFF">}-policy`</span><span style="color:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#E1E4E8">        statements: [</span></span>
<span class="line"><span style="color:#F97583">          new</span><span style="color:#E1E4E8"> iam.</span><span style="color:#B392F0">PolicyStatement</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">            actions: [</span><span style="color:#9ECBFF">'kms:Decrypt'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'s3:GetObject'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'s3:List*'</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">            resources: [props.bucket.bucketArn, </span><span style="color:#9ECBFF">`${</span><span style="color:#E1E4E8">props</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">bucket</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">bucketArn</span><span style="color:#9ECBFF">}/*`</span><span style="color:#E1E4E8">, props.bucket.encryptionKey</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">.keyArn],</span></span>
<span class="line"><span style="color:#E1E4E8">          }),</span></span>
<span class="line"><span style="color:#E1E4E8">        ],</span></span>
<span class="line"><span style="color:#E1E4E8">      })</span></span>
<span class="line"><span style="color:#E1E4E8">    )</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Now it’s possible to create a datasource from the S3 bucket.</p>
<h2 id="create-a-datasource-and-dataset">Create a datasource and dataset</h2>
<p>In Quicksight a data source is the connection to the data and the data set is using this data source and defining how the data will be used.</p>
<p>Quicksight has a lot of different data sources. We want to use the data from S3.</p>
<p>![quicksight datasource kinds]({{ site.baseurl }}/img/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/quicksight-datasource-kinds.png)</p>
<p>Currently, there is no L2 CDK construct for data sources so we need to use the L1 cloud formation.</p>
<p>In the case of a S3 data source, it’s a link to a manifest file</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> datasource</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> quicksightCfn.</span><span style="color:#B392F0">CfnDataSource</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'datasource'</span><span style="color:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#E1E4E8">      name: datasourceName,</span></span>
<span class="line"><span style="color:#E1E4E8">      type: </span><span style="color:#9ECBFF">'S3'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">      awsAccountId: Stack.</span><span style="color:#B392F0">of</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">).account,</span></span>
<span class="line"><span style="color:#E1E4E8">      dataSourceId: datasourceName,</span></span>
<span class="line"><span style="color:#E1E4E8">      dataSourceParameters: {</span></span>
<span class="line"><span style="color:#E1E4E8">        s3Parameters: {</span></span>
<span class="line"><span style="color:#E1E4E8">          manifestFileLocation: {</span></span>
<span class="line"><span style="color:#E1E4E8">            bucket: props.bucket.bucketName,</span></span>
<span class="line"><span style="color:#E1E4E8">            key: manifestKey,</span></span>
<span class="line"><span style="color:#E1E4E8">          },</span></span>
<span class="line"><span style="color:#E1E4E8">        },</span></span>
<span class="line"><span style="color:#E1E4E8">      },</span></span>
<span class="line"><span style="color:#E1E4E8">      permissions: permissionsDatasource,</span></span>
<span class="line"><span style="color:#E1E4E8">    })</span></span>
<span class="line"></span></code></pre>
<p>This is the definition of the manifest file. More about manifest files <a href="https://docs.aws.amazon.com/quicksight/latest/user/supported-manifest-file-format.html">here</a></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> manifest</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">      fileLocations: [</span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#E1E4E8">          URIPrefixes: [</span><span style="color:#9ECBFF">`s3://${</span><span style="color:#E1E4E8">props</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">bucket</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">bucketName</span><span style="color:#9ECBFF">}/${</span><span style="color:#E1E4E8">props</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">prefix</span><span style="color:#9ECBFF">}/`</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">        },</span></span>
<span class="line"><span style="color:#E1E4E8">      ],</span></span>
<span class="line"><span style="color:#E1E4E8">      globalUploadSettings: {</span></span>
<span class="line"><span style="color:#E1E4E8">        format: </span><span style="color:#9ECBFF">'JSON'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">      },</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span></code></pre>
<p>The dataset then defines which fields will be used and has the potential to format these fields.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> dataset</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> quicksightCfn.</span><span style="color:#B392F0">CfnDataSet</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'dataset'</span><span style="color:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#E1E4E8">      name: datasetName,</span></span>
<span class="line"><span style="color:#E1E4E8">      awsAccountId: Stack.</span><span style="color:#B392F0">of</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">).account,</span></span>
<span class="line"><span style="color:#E1E4E8">      dataSetId: datasetName,</span></span>
<span class="line"><span style="color:#E1E4E8">      importMode: </span><span style="color:#9ECBFF">'SPICE'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">      physicalTableMap: {</span></span>
<span class="line"><span style="color:#E1E4E8">        itemChanges: {</span></span>
<span class="line"><span style="color:#E1E4E8">          s3Source: {</span></span>
<span class="line"><span style="color:#E1E4E8">            dataSourceArn: datasource.attrArn,</span></span>
<span class="line"><span style="color:#E1E4E8">            uploadSettings: {</span></span>
<span class="line"><span style="color:#E1E4E8">              format: </span><span style="color:#9ECBFF">'JSON'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">            },</span></span>
<span class="line"><span style="color:#E1E4E8">            inputColumns: [</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'awsRegion'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'eventID'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'eventName'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'userIdentity'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'recordFormat'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'tableName'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'dynamodb.ApproximateCreationDateTime'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'dynamodb.Keys.pk.S'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'dynamodb.NewImage.pk.S'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'dynamodb.NewImage.person.M.jobArea.S'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'dynamodb.NewImage.person.M.firstname.S'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'dynamodb.NewImage.person.M.gender.S'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'dynamodb.NewImage.person.M.jobType.S'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'dynamodb.NewImage.person.M.jobDescriptor.S'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'dynamodb.NewImage.person.M.lastname.S'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'dynamodb.SizeBytes'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">              {</span></span>
<span class="line"><span style="color:#E1E4E8">                name: </span><span style="color:#9ECBFF">'eventSource'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                type: </span><span style="color:#9ECBFF">'STRING'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">              },</span></span>
<span class="line"><span style="color:#E1E4E8">            ],</span></span>
<span class="line"><span style="color:#E1E4E8">          },</span></span>
<span class="line"><span style="color:#E1E4E8">        },</span></span>
<span class="line"><span style="color:#E1E4E8">      },</span></span>
<span class="line"><span style="color:#E1E4E8">      logicalTableMap: {</span></span>
<span class="line"><span style="color:#E1E4E8">        logicalTableProperty: {</span></span>
<span class="line"><span style="color:#E1E4E8">          alias: </span><span style="color:#9ECBFF">`${</span><span style="color:#E1E4E8">datasetName</span><span style="color:#9ECBFF">}-alias`</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">          source: { physicalTableId: </span><span style="color:#9ECBFF">'itemChanges'</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">        },</span></span>
<span class="line"><span style="color:#E1E4E8">      },</span></span>
<span class="line"><span style="color:#E1E4E8">      permissions: permissionsDataset,</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"></span></code></pre>
<p>The whole definition is <a href="https://github.com/JohannesKonings/test-aws-dynamodb-athena-cdk/blob/main/cdk/lib/quicksight/quicksight.ts">here</a></p>
<p><a href="https://aws-blog.com/2021/09/building-quicksight-datasets-with-cdk-s3.html">Here</a> is a post that describes it with Python CDK.</p>
<h3 id="permission-to-see-the-datasource-and-dataset">permission to see the datasource and dataset</h3>
<p>Datasources and datasets will be only displayed if your user has permission for that. That is not automatically the case if you deploy it with CDK.
Therefore you need to put your user ARN to the permission. One way to do that is with an environment variable</p>
<p><code>QUICKSIGHT_USERNAME=&#x3C;&#x3C;Quicksight user name>> npx cdk deploy</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> quicksightUsername</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> process.env.</span><span style="color:#79B8FF">QUICKSIGHT_USERNAME</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> principalArn</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> `arn:aws:quicksight:${</span><span style="color:#E1E4E8">Stack</span><span style="color:#9ECBFF">.</span><span style="color:#B392F0">of</span><span style="color:#9ECBFF">(</span><span style="color:#79B8FF">this</span><span style="color:#9ECBFF">).</span><span style="color:#E1E4E8">region</span><span style="color:#9ECBFF">}:${</span><span style="color:#E1E4E8">Stack</span><span style="color:#9ECBFF">.</span><span style="color:#B392F0">of</span><span style="color:#9ECBFF">(</span><span style="color:#79B8FF">this</span><span style="color:#9ECBFF">).</span><span style="color:#E1E4E8">account</span><span style="color:#9ECBFF">}:user/default/${</span><span style="color:#E1E4E8">quicksightUsername</span><span style="color:#9ECBFF">}`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> permissionsDatasource</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">      {</span></span>
<span class="line"><span style="color:#E1E4E8">        principal: principalArn,</span></span>
<span class="line"><span style="color:#E1E4E8">        actions: [</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:DescribeDataSource'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:DescribeDataSourcePermissions'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:PassDataSource'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:UpdateDataSource'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:DeleteDataSource'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:UpdateDataSourcePermissions'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        ],</span></span>
<span class="line"><span style="color:#E1E4E8">      },</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> permissionsDataset</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">      {</span></span>
<span class="line"><span style="color:#E1E4E8">        principal: principalArn,</span></span>
<span class="line"><span style="color:#E1E4E8">        actions: [</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:DescribeDataSet'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:DescribeDataSetPermissions'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:PassDataSet'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:DescribeIngestion'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:ListIngestions'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:UpdateDataSet'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:DeleteDataSet'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:CreateIngestion'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:CancelIngestion'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          'quicksight:UpdateDataSetPermissions'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        ],</span></span>
<span class="line"><span style="color:#E1E4E8">      },</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"></span></code></pre>
<p>You can find the Quicksight username here</p>
<p>![quicksight username]({{ site.baseurl }}/img/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/quicksight-username.png)</p>
<h3 id="deployment-and-refresh-of-the-dataset">Deployment and refresh of the dataset</h3>
<p>If you deploy this setup the first time, the data does not exist, but the datasource links already to the data. That causes a deployment error.
To avoid this a little dummy data file will be deployed with a SDK call of a CDK custom resource</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> dummyJsonString</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> JSON</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">stringify</span><span style="color:#E1E4E8">({ dummy: </span><span style="color:#9ECBFF">'dummy'</span><span style="color:#E1E4E8">}); </span><span style="color:#6A737D">// Delete after deplyoment</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> customResourcePutObject</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> custom_resources.</span><span style="color:#B392F0">AwsCustomResource</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'prefix-creation'</span><span style="color:#E1E4E8">, { </span><span style="color:#6A737D">// add -put</span></span>
<span class="line"><span style="color:#E1E4E8">      onCreate: {</span></span>
<span class="line"><span style="color:#E1E4E8">        service: </span><span style="color:#9ECBFF">'S3'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        action: </span><span style="color:#9ECBFF">'putObject'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        parameters: {</span></span>
<span class="line"><span style="color:#E1E4E8">          Bucket: props.bucket.bucketName,</span></span>
<span class="line"><span style="color:#E1E4E8">          Key: </span><span style="color:#9ECBFF">`${</span><span style="color:#E1E4E8">props</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">prefix</span><span style="color:#9ECBFF">}/dummy.json`</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">          Body: dummyJsonString,</span></span>
<span class="line"><span style="color:#E1E4E8">        },</span></span>
<span class="line"><span style="color:#E1E4E8">        physicalResourceId: custom_resources.PhysicalResourceId.</span><span style="color:#B392F0">of</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'prefix-creation'</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">      },</span></span>
<span class="line"><span style="color:#E1E4E8">      policy: custom_resources.AwsCustomResourcePolicy.</span><span style="color:#B392F0">fromSdkCalls</span><span style="color:#E1E4E8">({ resources: custom_resources.AwsCustomResourcePolicy.</span><span style="color:#79B8FF">ANY_RESOURCE</span><span style="color:#E1E4E8"> }),</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">    props.</span></span>
<span class="line"></span></code></pre>
<p>After the datasource is deployed this will be removed</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> customResourceDeleteObject</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> custom_resources.</span><span style="color:#B392F0">AwsCustomResource</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'prefix-creation-delete'</span><span style="color:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#E1E4E8">      onCreate: {</span></span>
<span class="line"><span style="color:#E1E4E8">        service: </span><span style="color:#9ECBFF">'S3'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        action: </span><span style="color:#9ECBFF">'deleteObject'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        parameters: {</span></span>
<span class="line"><span style="color:#E1E4E8">          Bucket: props.bucket.bucketName,</span></span>
<span class="line"><span style="color:#E1E4E8">          Key: </span><span style="color:#9ECBFF">`${</span><span style="color:#E1E4E8">props</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">prefix</span><span style="color:#9ECBFF">}/dummy.json`</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        },</span></span>
<span class="line"><span style="color:#E1E4E8">        physicalResourceId: custom_resources.PhysicalResourceId.</span><span style="color:#B392F0">of</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'prefix-creation'</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">      },</span></span>
<span class="line"><span style="color:#E1E4E8">      policy: custom_resources.AwsCustomResourcePolicy.</span><span style="color:#B392F0">fromSdkCalls</span><span style="color:#E1E4E8">({ resources: custom_resources.AwsCustomResourcePolicy.</span><span style="color:#79B8FF">ANY_RESOURCE</span><span style="color:#E1E4E8"> }),</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">    props.bucket.</span><span style="color:#B392F0">grantReadWrite</span><span style="color:#E1E4E8">(customResourceDeleteObject);</span></span>
<span class="line"><span style="color:#E1E4E8">    customResourceDeleteObject.node.</span><span style="color:#B392F0">addDependency</span><span style="color:#E1E4E8">(dataset);</span></span>
<span class="line"></span></code></pre>
<p>After there is some data in the dynamodb you have to refresh the dataset. This is how it looks like if you create 5 new entries and then modify 1 and refresh again and use this data in an analysis.</p>
<p>![quicksight refresh dataset]({{ site.baseurl }}/img/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/quicksight-refresh-dataset.png)</p>
<p>![quicksight dataset imported rows]({{ site.baseurl }}/img/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/quicksight-dataset-imported-rows.png)</p>
<p>![quicksight dataset analysis]({{ site.baseurl }}/img/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/quicksight-dataset-analysis.png)</p>
<p>![quicksight analysis inserts]({{ site.baseurl }}/img/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/quicksight-analysis-inserts.png)</p>
<p>![quicksight analysis modify]({{ site.baseurl }}/img/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/quicksight-analysis-modify.png)</p>
<h1 id="cost-alert">Cost Alert 💰</h1>
<p>⚠️ Don’t forget to delete the Quicksight account after testing.</p>
<p>![quicksight delete account]({{ site.baseurl }}/img/2022-09-17-aws_example_ddb_analytics_quicksight_cdk/quicksight-delete-account.png)</p>
<h1 id="code">Code</h1>
<p><a href="https://github.com/JohannesKonings/test-aws-dynamodb-athena-cdk">https://github.com/JohannesKonings/test-aws-dynamodb-athena-cdk</a></p> </article> <div class="grid grid-cols-1 sm:grid-cols-2 gap-4"> <a href="/blog/2022-10-03-aws_example_ddb_export_athena_query" class="group p-4 gap-3 flex items-center border rounded-lg hover:bg-black/5 hover:dark:bg-white/10 border-black/15 dark:border-white/20 blend"> <div class="order-2 w-full h-full group-hover:text-black group-hover:dark:text-white blend"> <div class="flex flex-wrap gap-2"> <div class="text-sm uppercase">
Prev
</div> </div> <div class="font-semibold mt-3 text-black dark:text-white"> Example how to trigger a Dynamodb export and create an Athena saved query with CDK </div> </div> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="order-1 stroke-current group-hover:stroke-black group-hover:dark:stroke-white rotate-180"> <line x1="5" y1="12" x2="19" y2="12" class="scale-x-0 group-hover:scale-x-100 translate-x-4 group-hover:translate-x-1 transition-all duration-300 ease-in-out"></line> <polyline points="12 5 19 12 12 19" class="translate-x-0 group-hover:translate-x-1 transition-all duration-300 ease-in-out"></polyline> </svg> </a> <a href="/blog/2022-08-22-aws_example_ddb_analytics_athena_saved_queries_cdk" class="group p-4 gap-3 flex items-center border rounded-lg hover:bg-black/5 hover:dark:bg-white/10 border-black/15 dark:border-white/20 transition-colors duration-300 ease-in-out"> <div class="w-full h-full text-right group-hover:text-black group-hover:dark:text-white blend"> <div class="text-sm uppercase">
Next
</div> <div class="font-semibold mt-3 text-black dark:text-white"> Example how to create Athena saved queries with CDK </div> </div> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="stroke-current group-hover:stroke-black group-hover:dark:stroke-white"> <line x1="5" y1="12" x2="19" y2="12" class="scale-x-0 group-hover:scale-x-100 translate-x-4 group-hover:translate-x-1 transition-all duration-300 ease-in-out"></line> <polyline points="12 5 19 12 12 19" class="translate-x-0 group-hover:translate-x-1 transition-all duration-300 ease-in-out"></polyline> </svg> </a> </div> </div> </div>   </div> </div>  </main> <footer class="relative bg-white dark:bg-black"> <div class="animate"> <section class="py-5"> <div class="w-full h-full mx-auto px-5 max-w-screen-md">  <div class="flex items-center justify-center sm:justify-end"> <button id="back-to-top" aria-label="Back to top of page" class="group flex w-fit p-1.5 gap-1.5 text-sm items-center border rounded hover:bg-black/5 hover:dark:bg-white/10 border-black/15 dark:border-white/20 transition-colors duration-300 ease-in-out"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="stroke-current group-hover:stroke-black group-hover:dark:stroke-white rotate-90"> <line x1="19" y1="12" x2="5" y2="12" class="scale-x-0 group-hover:scale-x-100 translate-x-3 group-hover:translate-x-0 transition-all duration-300 ease-in-out"></line> <polyline points="12 19 5 12 12 5" class="translate-x-1 group-hover:translate-x-0 transition-all duration-300 ease-in-out"></polyline> </svg> <div class="w-full group-hover:text-black group-hover:dark:text-white transition-colors duration-300 ease-in-out">
Back to top
</div> </button> </div>  </div> </section> <section class="py-5 overflow-hidden whitespace-nowrap border-t border-black/10 dark:border-white/25"> <div class="w-full h-full mx-auto px-5 max-w-screen-md">  <div class="h-full grid grid-cols-1 sm:grid-cols-2 gap-3"> <div class="order-2 sm:order-1 flex flex-col items-center justify-center sm:items-start"> <div class="legal"> <a href="/legal/terms" class="text-current hover:text-black dark:hover:text-white transition-colors duration-300 ease-in-out">
Terms
</a> |
<a href="/legal/privacy" class="text-current hover:text-black dark:hover:text-white transition-colors duration-300 ease-in-out">
Privacy
</a> </div> <div class="text-sm mt-2">&copy; 2024 | All rights reserved</div> </div> <div class="order-1 sm:order-2 flex justify-center sm:justify-end"> <div class="flex flex-wrap gap-1 items-center justify-center"> <!-- {
                SOCIALS.map((SOCIAL) => (
                  <a 
                    href={SOCIAL.HREF} 
                    target="_blank" 
                    aria-label={`${SITE.TITLE} on ${SOCIAL.NAME}`} 
                    class="group size-10 rounded-full p-2 items-center justify-center hover:bg-black/5 dark:hover:bg-white/20  blend"
                  >
                    <svg class="size-full fill-current group-hover:fill-black group-hover:dark:fill-white blend">
                      <use href={`/social.svg#${SOCIAL.ICON}`} />
                    </svg>
                  </a>
                ))
              } --> <a href="https://github.com/JohannesKonings/JohannesKonings.github.io" target="_blank" aria-label="GitHub repo" class="group size-10 rounded-full p-2 items-center justify-center hover:bg-black/5 dark:hover:bg-white/20 blend"> <svg class="size-full fill-current group-hover:fill-black group-hover:dark:fill-white blend"> <use href="/social.svg#github"></use> </svg> </a> </div> </div> </div>  </div> </section> </div> </footer> <script>
  function goBackToTop(event) {
    event.preventDefault();
    window.scrollTo({
      top: 0,
      behavior: "smooth",
    });
  }

  function inintializeBackToTop() {
    const backToTop = document.getElementById("back-to-top");
    backToTop?.addEventListener("click", goBackToTop);
  }

  document.addEventListener("astro:after-swap", inintializeBackToTop);
  inintializeBackToTop();
</script> </body></html>