<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/next-blog/out/_next/static/css/66c48826d6382dcb.css" as="style" crossorigin=""/><link rel="stylesheet" href="/next-blog/out/_next/static/css/66c48826d6382dcb.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/next-blog/out/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/next-blog/out/_next/static/chunks/webpack-7af3f00e54ee1119.js" defer="" crossorigin=""></script><script src="/next-blog/out/_next/static/chunks/framework-5429a50ba5373c56.js" defer="" crossorigin=""></script><script src="/next-blog/out/_next/static/chunks/main-def68a4901fa3cc6.js" defer="" crossorigin=""></script><script src="/next-blog/out/_next/static/chunks/pages/_app-a5ae041df49b62a0.js" defer="" crossorigin=""></script><script src="/next-blog/out/_next/static/chunks/56-99b6b0e6945aba0d.js" defer="" crossorigin=""></script><script src="/next-blog/out/_next/static/chunks/pages/post/%5Bslug%5D-c07d00169c09ab18.js" defer="" crossorigin=""></script><script src="/next-blog/out/_next/static/2zVoAH4240IV3odeQrveE/_buildManifest.js" defer="" crossorigin=""></script><script src="/next-blog/out/_next/static/2zVoAH4240IV3odeQrveE/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen"><header class="bg-fuchsia-100 mb-8 py-4"><div class="container mx-auto flex justify-center"><a href="/next-blog/out">üè°</a><span class="mx-auto">Welcome to my blog</span> </div></header><main class="container mx-auto flex-1"><div><div class="prose mx-auto"><h1>AWS Amplify Console: How I changed master branch and env to main</h1><div><p>As part of #BlackLivesMatter there was a discussion to rename git branch master to main. How to do that in git and GitHub and some more about the background is described here:
<a href="http://www.kapwing.com/blog/how-to-rename-your-master-branch-to-main-in-git/">http://www.kapwing.com/blog/how-to-rename-your-master-branch-to-main-in-git/</a></p>
<p>Together with the master branch I had a master env, which was connected to the git master branch in the amplify console. I also wanted to rename this master env.</p>
<h1>AWS Amplify</h1>
<p>After the master branch was renamed to main, the corresponding env have to be also renamed from master to main.</p>
<h2>Create new env</h2>
<p>Check If you are in the master env with <code>amplify status</code>. If not checkout the master env with <code>amplify env checkout master</code>.
Run the command <code>amplify add env main</code> and <code>amplify push</code>. After that, you can connect the main branch with the main env in the amplify console.</p>
<h2>Connection of main branch with main env in the Amplify Console</h2>
<p>The new main branch and the new main env can now be connected in the amplify console.</p>
<p>![Amplify Console connection branch to env]({{ site.baseurl }}/img/2020-08-18-amplify_env_master_to_main/amplify_console_connection_branch_to_env1.png)</p>
<p>![Amplify Console connection branch to env]({{ site.baseurl }}/img/2020-08-18-amplify_env_master_to_main/amplify_console_connection_branch_to_env2.png)</p>
<p>Afterwards the production branch must be changed to main.</p>
<p>![Amplify Console production branch]({{ site.baseurl }}/img/2020-08-18-amplify_env_master_to_main/amplify_console_production_branch.png)</p>
<h1>Migration</h1>
<p>The new env main is now ready to use, but the data is missing. That must be migrated from the master env to the main env. In my case, it was Cognito users, DynamoDB data and S3 profile photos.</p>
<h2>Cognito</h2>
<p>There are some approaches to export und import cognito users:</p>
<p><a href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-import-users.html">https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-import-users.html</a></p>
<p><a href="https://medium.com/collaborne-engineering/migrate-aws-cognito-user-pools-ff2a91a745a2">https://medium.com/collaborne-engineering/migrate-aws-cognito-user-pools-ff2a91a745a2</a></p>
<p>However, since it is a small internal app, it is sufficient for users to register again üòä</p>
<h2>DynamoDb</h2>
<p>The DynamoDB data is more important. The easiest way to migrate the data was with a shell script and the aws cli:</p>
<p><a href="https://github.com/JohannesKonings/fff-badminton/blob/main/AmplifyEnvMigration/dynamodb-migration.sh">dynamodb-migration.sh</a></p>
<h2>S3</h2>
<p>As described here the users can upload new profile pictures:
<a href="https://dev.to/johanneskonings/aws-amplify-storage-react-example-for-avatar-pictures-273o">AWS Amplify Storage: React example for Avatar pictures</a></p>
<p>That profile pictures can also be copied by a script <a href="https://github.com/JohannesKonings/fff-badminton/blob/main/AmplifyEnvMigration/s3-migration.sh">s3-migration.sh</a>. But it's necessary to rename the folder name to the new identity pool identity browser id, that the pictures will be found.</p>
<p>![identity brwoser]({{ site.baseurl }}/img/2020-08-18-amplify_env_master_to_main/identity_browser.png)</p>
<p>I fixed that manually üòä</p>
</div></div></div></main><footer class="bg-fuchsia-100 mt-8 py-4"><div class="container mx-auto flex justify-center"><a href="/next-blog/out/impressum">Impressum</a></div><div class="container mx-auto flex justify-center">&lt;/&gt; on <a href="https://github.com/JohannesKonings/JohannesKonings.github.io">Github</a> ¬†<i class="fa fa-github-alt"></i></div></footer></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"frontmatter":{"layout":"post","title":"AWS Amplify Console: How I changed master branch and env to main","published":true,"date":"2020-08-18 08:15:18","summary":"Change of the master branch end amplfiy env to main and migration of the env data","categories":"aws","thumbnail":null,"tags":["aws","AWS Amplify","AWS Amplify Console"]},"content":"\nAs part of #BlackLivesMatter there was a discussion to rename git branch master to main. How to do that in git and GitHub and some more about the background is described here:\n[http://www.kapwing.com/blog/how-to-rename-your-master-branch-to-main-in-git/](http://www.kapwing.com/blog/how-to-rename-your-master-branch-to-main-in-git/)\n\nTogether with the master branch I had a master env, which was connected to the git master branch in the amplify console. I also wanted to rename this master env.\n\n# AWS Amplify \n\nAfter the master branch was renamed to main, the corresponding env have to be also renamed from master to main.\n\n## Create new env\n\nCheck If you are in the master env with `amplify status`. If not checkout the master env with `amplify env checkout master`.\nRun the command `amplify add env main` and `amplify push`. After that, you can connect the main branch with the main env in the amplify console.\n\n## Connection of main branch with main env in the Amplify Console\n\nThe new main branch and the new main env can now be connected in the amplify console.\n\n![Amplify Console connection branch to env]({{ site.baseurl }}/img/2020-08-18-amplify_env_master_to_main/amplify_console_connection_branch_to_env1.png)\n\n![Amplify Console connection branch to env]({{ site.baseurl }}/img/2020-08-18-amplify_env_master_to_main/amplify_console_connection_branch_to_env2.png)\n\nAfterwards the production branch must be changed to main.\n\n![Amplify Console production branch]({{ site.baseurl }}/img/2020-08-18-amplify_env_master_to_main/amplify_console_production_branch.png)\n\n# Migration\n\nThe new env main is now ready to use, but the data is missing. That must be migrated from the master env to the main env. In my case, it was Cognito users, DynamoDB data and S3 profile photos.\n\n## Cognito\n\nThere are some approaches to export und import cognito users:\n\n[https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-import-users.html](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-import-users.html)\n\n[https://medium.com/collaborne-engineering/migrate-aws-cognito-user-pools-ff2a91a745a2](https://medium.com/collaborne-engineering/migrate-aws-cognito-user-pools-ff2a91a745a2)\n\nHowever, since it is a small internal app, it is sufficient for users to register again üòä\n\n\n## DynamoDb\n\nThe DynamoDB data is more important. The easiest way to migrate the data was with a shell script and the aws cli: \n\n[dynamodb-migration.sh](https://github.com/JohannesKonings/fff-badminton/blob/main/AmplifyEnvMigration/dynamodb-migration.sh)\n\n## S3\n\nAs described here the users can upload new profile pictures:\n[AWS Amplify Storage: React example for Avatar pictures](https://dev.to/johanneskonings/aws-amplify-storage-react-example-for-avatar-pictures-273o)\n\nThat profile pictures can also be copied by a script [s3-migration.sh](https://github.com/JohannesKonings/fff-badminton/blob/main/AmplifyEnvMigration/s3-migration.sh). But it's necessary to rename the folder name to the new identity pool identity browser id, that the pictures will be found.\n\n![identity brwoser]({{ site.baseurl }}/img/2020-08-18-amplify_env_master_to_main/identity_browser.png)\n\nI fixed that manually üòä\n\n\n\n\n\n\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2020-08-18-amplify_env_master_to_main"},"buildId":"2zVoAH4240IV3odeQrveE","assetPrefix":"/next-blog/out","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>