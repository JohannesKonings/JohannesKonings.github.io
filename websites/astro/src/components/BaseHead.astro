---
interface Props {
	title: string;
	description: string;
	image?: string;
	coverImageSrc?: string;
	ogType?: "website" | "article";
	publishedTime?: string;
	modifiedTime?: string;
	imageAlt?: string;
}

const canonicalURL = new URL(Astro.url.pathname, Astro.site ?? Astro.url);
const siteName = "Johannes Konings";

const {
	title,
	description,
	image = "/open-graph.jpg",
	coverImageSrc,
	ogType,
	publishedTime,
	modifiedTime,
	imageAlt,
} = Astro.props;

const hasCoverImage =
	typeof coverImageSrc === "string" && coverImageSrc.trim().length > 0;
const socialImagePath = hasCoverImage ? coverImageSrc : image;
const socialImageURL = new URL(socialImagePath, Astro.site ?? Astro.url).toString();
const isArticlePath =
	Astro.url.pathname.startsWith("/blog/") ||
	Astro.url.pathname.startsWith("/notes/");
const resolvedOgType = ogType ?? (isArticlePath ? "article" : "website");
const resolvedImageAlt = imageAlt ?? `${title} social preview`;
const imagePathWithoutQuery = socialImagePath.split("?")[0]?.toLowerCase();
const socialImageType =
	imagePathWithoutQuery?.endsWith(".png")
		? "image/png"
		: imagePathWithoutQuery?.endsWith(".jpg") ||
			  imagePathWithoutQuery?.endsWith(".jpeg")
			? "image/jpeg"
			: imagePathWithoutQuery?.endsWith(".webp")
				? "image/webp"
				: imagePathWithoutQuery?.endsWith(".gif")
					? "image/gif"
					: imagePathWithoutQuery?.endsWith(".avif")
						? "image/avif"
						: undefined;
---

<!-- Global Metadata -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" type="image/x-icon" href="/favicon.ico" />
<meta name="generator" content={Astro.generator} />

<link
  rel="preload"
  href="/fonts/CascadiaMonoNF.woff2"
  as="font"
  type="font/woff2"
  crossorigin
/>
<link
  rel="preload"
  href="/fonts/CascadiaMonoNF-SemiBold.woff2"
  as="font"
  type="font/woff2"
  crossorigin
/>

<!-- Canonical URL -->
<link rel="canonical" href={canonicalURL.toString()} />

<!-- Primary Meta Tags -->
<title>{title}</title>
<meta name="title" content={title} />
<meta name="description" content={description} />

<!-- Open Graph / Facebook -->
<meta property="og:type" content={resolvedOgType} />
<meta property="og:site_name" content={siteName} />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content={canonicalURL.toString()} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={socialImageURL} />
<meta property="og:image:alt" content={resolvedImageAlt} />
{socialImageType && <meta property="og:image:type" content={socialImageType} />}
{
  resolvedOgType === "article" && publishedTime && (
    <meta property="article:published_time" content={publishedTime} />
  )
}
{
  resolvedOgType === "article" && modifiedTime && (
    <meta property="article:modified_time" content={modifiedTime} />
  )
}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={canonicalURL.toString()} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={socialImageURL} />
<meta name="twitter:image:alt" content={resolvedImageAlt} />
<meta name="twitter:domain" content={canonicalURL.hostname} />

<!-- Sitemap -->
<link rel="sitemap" href="/sitemap-index.xml" />

<!-- RSS Feed -->
<link
  rel="alternate"
  type="application/rss+xml"
  title={title}
  href={`${Astro.site}rss.xml`}
/>

<!-- Global Scripts -->
<script is:inline src="/js/theme.js"></script>
<script is:inline src="/js/scroll.js"></script>
<script is:inline src="/js/animate.js"></script>

<!-- <ViewTransitions  /> -->

<script>
  import type { TransitionBeforeSwapEvent } from "astro:transitions/client";
  document.addEventListener("astro:before-swap", (e) =>
    [
      ...(e as TransitionBeforeSwapEvent).newDocument.head.querySelectorAll(
        'link[as="font"]'
      ),
    ].forEach((link) => link.remove())
  );
</script>
